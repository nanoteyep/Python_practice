CREATE TABLE TB_POPLTN_DATA
(
    ADMINIST_ZONE VARCHAR2(150) --"행정구역"
    , TOT_POPLTN_CO NUMBER(10) --"2020년10월_계_총인구수"
    , AGE_SCTN_POPLTN_CO NUMBER(10) --"2020년10월_계_연령구간인구수"
    , POPLTN_CO_0_9 NUMBER(10) --"2020년10월_계_0~9세"
    , POPLTN_CO_10_19 NUMBER(10) --"2020년10월_계_10~19세"
    , POPLTN_CO_20_29 NUMBER(10) --"2020년10월_계_20~29세"
    , POPLTN_CO_30_39 NUMBER(10) --"2020년10월_계_30~39세"
    , POPLTN_CO_40_49 NUMBER(10) --"2020년10월_계_40~49세"
    , POPLTN_CO_50_59 NUMBER(10) --"2020년10월_계_50~59세"
    , POPLTN_CO_60_69 NUMBER(10) --"2020년10월_계_60~69세"
    , POPLTN_CO_70_79 NUMBER(10) --"2020년10월_계_70~79세"
    , POPLTN_CO_80_89 NUMBER(10) --"2020년10월_계_80~89세"
    , POPLTN_CO_90_99 NUMBER(10) --"2020년10월_계_90~99세"
    , POPLTN_CO_100 NUMBER(10) --"2020년10월_계_100세 이상"
    , MALE_TOT_POPLTN_CO NUMBER(10) --"2020년10월_남_총인구수"
    , MALE_AGE_SCTN_POPLTN_CO NUMBER(10) --"2020년10월_남_연령구간인구수"
    , MALE_POPLTN_CO_0_9 NUMBER(10) --"2020년10월_남_0~9세"
    , MALE_POPLTN_CO_10_19 NUMBER(10) --"2020년10월_남_10~19세"
    , MALE_POPLTN_CO_20_29 NUMBER(10) --"2020년10월_남_20~29세"
    , MALE_POPLTN_CO_30_39 NUMBER(10) --"2020년10월_남_30~39세"
    , MALE_POPLTN_CO_40_49 NUMBER(10) --"2020년10월_남_40~49세"
    , MALE_POPLTN_CO_50_59 NUMBER(10) --"2020년10월_남_50~59세"
    , MALE_POPLTN_CO_60_69 NUMBER(10) --"2020년10월_남_60~69세"
    , MALE_POPLTN_CO_70_79 NUMBER(10) --"2020년10월_남_70~79세"
    , MALE_POPLTN_CO_80_89 NUMBER(10) --"2020년10월_남_80~89세"
    , MALE_POPLTN_CO_90_99 NUMBER(10) --"2020년10월_남_90~99세"
    , MALE_POPLTN_CO_100 NUMBER(10) --"2020년10월_남_100세 이상"
    , FEMALE_TOT_POPLTN_CO NUMBER(10) --"2020년10월_여_Z총인구수"
    , FEMALE_AGE_SCTN_POPLTN_CO NUMBER(10) --"2020년10월_여_연령구간인구수"
    , FEMALE_POPLTN_CO_0_9 NUMBER(10) --"2020년10월_여_0~9세"
    , FEMALE_POPLTN_CO_10_19 NUMBER(10) --"2020년10월_여_10~19세"
    , FEMALE_POPLTN_CO_20_29 NUMBER(10) --"2020년10월_여_20~29세"
    , FEMALE_POPLTN_CO_30_39 NUMBER(10) --"2020년10월_여_30~39세"
    , FEMALE_POPLTN_CO_40_49 NUMBER(10) --"2020년10월_여_40~49세"
    , FEMALE_POPLTN_CO_50_59 NUMBER(10) --"2020년10월_여_50~59세"
    , FEMALE_POPLTN_CO_60_69 NUMBER(10) --"2020년10월_여_60~69세"
    , FEMALE_POPLTN_CO_70_79 NUMBER(10) --"2020년10월_여_70~79세"
    , FEMALE_POPLTN_CO_80_89 NUMBER(10) --"2020년10월_여_80~89세"
    , FEMALE_POPLTN_CO_90_99 NUMBER(10) --"2020년10월_여_90~99세"
    , FEMALE_POPLTN_CO_100 NUMBER(10) --"2020년10월_여_100세 이상"
);

SELECT COUNT(*) FROM tb_popltn_data;

CREATE TABLE TB_POPLTN
(
    ADMINIST_ZONE_NO CHAR(10)
    , ADMINIST_ZONE_NM VARCHAR2(150)
    , STD_MT CHAR(6)
    , POPLTN_SE_CD CHAR(1) --M:남성, F:여성, T:전체
    , AGRDE_SE_CD CHAR(3) -- '000':0대,'010':10대,'020':20대,'030':30대,'040':40대,'050':50대,'060':60대,'070':70대,'080':80대,'090':90대, '100':'100대'
    , POPLTN_CNT NUMBER(10)
    , CONSTRAINT TB_POPLTN_PK PRIMARY KEY (ADMINIST_ZONE_NO, STD_MT, POPLTN_SE_CD, AGRDE_SE_CD)
);

INSERT INTO TB_POPLTN
SELECT A.ADMINIST_ZONE_NO, A.ADMINIST_ZONE_NM, A.STD_MT
    , CASE WHEN LVL1 = 1 THEN 'M' WHEN LVL1 = 2 THEN 'F' WHEN LVL1 = 3 THEN 'T' END AS POPLTN_SE_CD
    , CASE WHEN LVL2 = 1 THEN '000' WHEN LVL2 = 2 THEN '010' WHEN LVL2 = 3 THEN '020'
    WHEN LVL2 = 4 THEN '030' WHEN LVL2 = 5 THEN '040' WHEN LVL2 = 6 THEN '050'
    WHEN LVL2 = 7 THEN '060' WHEN LVL2 = 8 THEN '070' WHEN LVL2 = 9 THEN '080' WHEN LVL2 = 10 THEN '090' WHEN LVL2 = 11 THEN '100' END AS AGRDE_SE_CD
    , CASE WHEN LVL1 = 1 AND LVL2 = 1 THEN MALE_POPLTN_CO_0_9 WHEN LVL1 = 1 AND LVL2 = 2 THEN MALE_POPLTN_CO_10_19
    WHEN LVL1 = 1 AND LVL2 = 3 THEN MALE_POPLTN_CO_20_29 WHEN LVL1 = 1 AND LVL2 = 4 THEN MALE_POPLTN_CO_30_39
    WHEN LVL1 = 1 AND LVL2 = 5 THEN MALE_POPLTN_CO_40_49 WHEN LVL1 = 1 AND LVL2 = 6 THEN MALE_POPLTN_CO_50_59
    WHEN LVL1 = 1 AND LVL2 = 7 THEN MALE_POPLTN_CO_60_69 WHEN LVL1 = 1 AND LVL2 = 8 THEN MALE_POPLTN_CO_70_79
    WHEN LVL1 = 1 AND LVL2 = 9 THEN MALE_POPLTN_CO_80_89 WHEN LVL1 = 1 AND LVL2 = 10 THEN MALE_POPLTN_CO_90_99
    WHEN LVL1 = 1 AND LVL2 = 11 THEN MALE_POPLTN_CO_100 WHEN LVL1 = 2 AND LVL2 = 1 THEN FEMALE_POPLTN_CO_0_9
    WHEN LVL1 = 2 AND LVL2 = 2 THEN FEMALE_POPLTN_CO_10_19 WHEN LVL1 = 2 AND LVL2 = 3 THEN FEMALE_POPLTN_CO_20_29
    WHEN LVL1 = 2 AND LVL2 = 4 THEN FEMALE_POPLTN_CO_30_39 WHEN LVL1 = 2 AND LVL2 = 5 THEN FEMALE_POPLTN_CO_40_49
    WHEN LVL1 = 2 AND LVL2 = 6 THEN FEMALE_POPLTN_CO_50_59 WHEN LVL1 = 2 AND LVL2 = 7 THEN FEMALE_POPLTN_CO_60_69
    WHEN LVL1 = 2 AND LVL2 = 8 THEN FEMALE_POPLTN_CO_70_79 WHEN LVL1 = 2 AND LVL2 = 9 THEN FEMALE_POPLTN_CO_80_89
    WHEN LVL1 = 2 AND LVL2 = 10 THEN FEMALE_POPLTN_CO_90_99 WHEN LVL1 = 2 AND LVL2 = 11 THEN FEMALE_POPLTN_CO_100
    WHEN LVL1 = 3 AND LVL2 = 1 THEN POPLTN_CO_0_9 WHEN LVL1 = 3 AND LVL2 = 2 THEN POPLTN_CO_10_19
    WHEN LVL1 = 3 AND LVL2 = 3 THEN POPLTN_CO_20_29 WHEN LVL1 = 3 AND LVL2 = 4 THEN POPLTN_CO_30_39
    WHEN LVL1 = 3 AND LVL2 = 5 THEN POPLTN_CO_40_49 WHEN LVL1 = 3 AND LVL2 = 6 THEN POPLTN_CO_50_59
    WHEN LVL1 = 3 AND LVL2 = 7 THEN POPLTN_CO_60_69 WHEN LVL1 = 3 AND LVL2 = 8 THEN POPLTN_CO_70_79
    WHEN LVL1 = 3 AND LVL2 = 9 THEN POPLTN_CO_80_89 WHEN LVL1 = 3 AND LVL2 = 10 THEN POPLTN_CO_90_99
    WHEN LVL1 = 3 AND LVL2 = 11 THEN POPLTN_CO_100 END AS POPLTN_CNT
    
FROM
    (
        SELECT SUBSTR(ADMINIST_ZONE, INSTR(ADMINIST_ZONE, '(') + 1, 10) AS ADMINIST_ZONE_NO
            , SUBSTR(ADMINIST_ZONE, 1, INSTR(ADMINIST_ZONE, '(')-1) AS ADMINIST_ZONE_NM, '202010' AS STD_MT
            , MALE_POPLTN_CO_0_9 , MALE_POPLTN_CO_10_19 , MALE_POPLTN_CO_20_29
            , MALE_POPLTN_CO_30_39 , MALE_POPLTN_CO_40_49 , MALE_POPLTN_CO_50_59
            , MALE_POPLTN_CO_60_69 , MALE_POPLTN_CO_70_79 , MALE_POPLTN_CO_80_89 , MALE_POPLTN_CO_90_99 , MALE_POPLTN_CO_100
            , FEMALE_POPLTN_CO_0_9 , FEMALE_POPLTN_CO_10_19, FEMALE_POPLTN_CO_20_29
            , FEMALE_POPLTN_CO_30_39, FEMALE_POPLTN_CO_40_49, FEMALE_POPLTN_CO_50_59
            , FEMALE_POPLTN_CO_60_69, FEMALE_POPLTN_CO_70_79, FEMALE_POPLTN_CO_80_89, FEMALE_POPLTN_CO_90_99, FEMALE_POPLTN_CO_100
            , POPLTN_CO_0_9 , POPLTN_CO_10_19, POPLTN_CO_20_29
            , POPLTN_CO_30_39 , POPLTN_CO_40_49, POPLTN_CO_50_59
            , POPLTN_CO_60_69 , POPLTN_CO_70_79, POPLTN_CO_80_89, POPLTN_CO_90_99, POPLTN_CO_100
            , LVL1, LVL2
        FROM TB_POPLTN_DATA, (SELECT LEVEL AS LVL1 FROM DUAL CONNECT BY LEVEL <= 3), (SELECT LEVEL AS LVL2 FROM DUAL CONNECT BY LEVEL <= 11)
    ) A ;
COMMIT;
